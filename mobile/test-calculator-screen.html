<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Screen Test - Egyptian Mortgage Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .calculator-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .calculator-section h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 16px;
            color: #374151;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 16px;
            background: white;
            text-align: right;
        }

        .bank-selector {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calculate-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 16px;
            transition: all 0.3s ease;
        }

        .calculate-button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 8px;
        }

        .result-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .banks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .bank-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bank-card:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
        }

        .bank-card.selected {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .bank-name {
            font-size: 16px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .bank-name-ar {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .bank-rate {
            font-size: 14px;
            color: #2563eb;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .bank-features {
            font-size: 12px;
            color: #059669;
        }

        .tabs {
            display: flex;
            background: white;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            background: #f8fafc;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #2563eb;
            color: white;
        }

        .payment-schedule {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }

        .schedule-header {
            background: #f8fafc;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            padding: 12px 8px;
            font-weight: bold;
            color: #374151;
            text-align: center;
        }

        .schedule-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            padding: 8px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 12px;
            color: #6b7280;
            text-align: center;
        }

        .console {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.6;
            margin-top: 20px;
        }

        .console-line {
            margin-bottom: 5px;
        }

        .console-line.success {
            color: #10b981;
        }

        .console-line.error {
            color: #ef4444;
        }

        .console-line.info {
            color: #3b82f6;
        }

        .affordability-tips {
            background: #f0f9ff;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .tips-title {
            font-size: 16px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 12px;
        }

        .tip-item {
            font-size: 14px;
            color: #374151;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .action-button {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</h1>
            <p>Ø­Ø§Ø³Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ÙÙŠ Ù…ØµØ± Ù…Ø¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ©</p>
        </div>

        <div class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('calculator')">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù‚Ø±Ø¶</button>
                <button class="tab" onclick="switchTab('affordability')">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù‚Ø¯Ø±Ø©</button>
            </div>

            <!-- Calculator Tab -->
            <div id="calculator-tab">
                <!-- Egyptian Banks -->
                <div class="calculator-section">
                    <h2>ğŸ›ï¸ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…ØµØ±ÙŠØ©</h2>
                    <div class="banks-grid" id="banksGrid">
                        <!-- Banks will be populated here -->
                    </div>
                </div>

                <!-- Calculator Form -->
                <div class="calculator-section">
                    <h2>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ù‚Ø±Ø¶</h2>
                    <div class="form-grid">
                        <div class="input-group">
                            <label class="input-label">Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø§Ø± (Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ)</label>
                            <input type="number" class="input-field" id="propertyPrice" placeholder="Ù…Ø«Ø§Ù„: 2000000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù‚Ø¯Ù… (%)</label>
                            <input type="number" class="input-field" id="downPaymentPercent" value="20" placeholder="20">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ù…Ø¯Ø© Ø§Ù„Ù‚Ø±Ø¶ (Ø³Ù†Ø©)</label>
                            <input type="number" class="input-field" id="termYears" value="25" placeholder="25">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø®ØªØ§Ø±</label>
                            <div class="bank-selector" id="bankSelector">
                                <span id="selectedBankName">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ</span>
                                <span>ğŸ‘‡</span>
                            </div>
                        </div>
                    </div>
                    <button class="calculate-button" onclick="calculateMortgage()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</button>
                </div>

                <!-- Results -->
                <div class="calculator-section" id="resultsSection" style="display: none;">
                    <h2>ğŸ’° Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
                    <div class="results-grid" id="resultsGrid">
                        <!-- Results will be populated here -->
                    </div>
                    <div class="action-buttons">
                        <button class="action-button" onclick="showPaymentSchedule()">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¯Ø§Ø¯</button>
                        <button class="action-button" onclick="shareCalculation()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
                        <button class="action-button" onclick="saveCalculation()">ğŸ’¾ Ø­ÙØ¸</button>
                    </div>
                    <div class="payment-schedule" id="paymentSchedule" style="display: none;">
                        <div class="schedule-header">
                            <div>Ø´Ù‡Ø±</div>
                            <div>Ù‚Ø³Ø·</div>
                            <div>Ø£ØµÙ„</div>
                            <div>ÙÙˆØ§Ø¦Ø¯</div>
                            <div>Ø±ØµÙŠØ¯</div>
                        </div>
                        <div id="scheduleRows">
                            <!-- Schedule rows will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Affordability Tab -->
            <div id="affordability-tab" style="display: none;">
                <div class="calculator-section">
                    <h2>ğŸ¯ Ø§Ø­Ø³Ø¨ Ù‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
                    <div class="input-group">
                        <label class="input-label">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠ (Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ)</label>
                        <input type="number" class="input-field" id="monthlyIncome" placeholder="Ù…Ø«Ø§Ù„: 25000">
                    </div>
                    <button class="calculate-button" onclick="calculateAffordability()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±Ø§Ø¡</button>
                    
                    <div class="affordability-tips">
                        <div class="tips-title">ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù…Ù‡Ù…Ø©:</div>
                        <div class="tip-item">â€¢ ÙŠÙÙ†ØµØ­ Ø¨Ø£Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‚Ø³Ø· 33% Ù…Ù† Ø§Ù„Ø¯Ø®Ù„</div>
                        <div class="tip-item">â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ù…Ø¨Ù„Øº Ù„Ù„Ø·ÙˆØ§Ø±Ø¦ (6 Ø£Ø´Ù‡Ø± Ù…ØµØ§Ø±ÙŠÙ)</div>
                        <div class="tip-item">â€¢ Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø±Ø³ÙˆÙ… - ØªØ£Ù…ÙŠÙ†)</div>
                        <div class="tip-item">â€¢ Ù‚Ø§Ø±Ù† Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</div>
                    </div>
                </div>
            </div>

            <!-- Console -->
            <div class="calculator-section">
                <h2>ğŸ“œ ÙˆØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                <div class="console" id="console">
                    <div class="console-line info">ğŸš€ Egyptian Mortgage Calculator Test Interface Loaded</div>
                    <div class="console-line info">ğŸ¦ Ready to test mortgage calculations with Egyptian banks</div>
                    <div class="console-line info"></div>
                    <div class="console-line info">Features to test:</div>
                    <div class="console-line info">âœ… Egyptian bank integration (5 major banks)</div>
                    <div class="console-line info">âœ… Mortgage calculation with local interest rates</div>
                    <div class="console-line info">âœ… Payment schedule visualization (5 years)</div>
                    <div class="console-line info">âœ… Affordability calculator with Egyptian standards</div>
                    <div class="console-line info">âœ… EGP currency formatting</div>
                    <div class="console-line info">âœ… Bank limits and requirements validation</div>
                    <div class="console-line info">âœ… Save and share functionality</div>
                    <div class="console-line info">âœ… Arabic localization</div>
                    <div class="console-line info"></div>
                    <div class="console-line info">Select a bank and enter property details to start! ğŸ¯</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let selectedBank = null;
        let currentCalculation = null;

        // Egyptian Banks Data
        const egyptianBanks = [
            {
                id: 'nbe',
                name: 'National Bank of Egypt',
                nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ',
                interestRate: 18.5,
                maxLoanAmount: 15000000,
                maxTerm: 30,
                minDownPayment: 20,
                processingFee: 1.5,
                features: ['Ø£ÙˆÙ„ Ø¨Ù†Ùƒ ÙÙŠ Ù…ØµØ±', 'Ø´Ø±ÙˆØ· Ù…ÙŠØ³Ø±Ø©', 'Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù…ØªØ§Ø²Ø©']
            },
            {
                id: 'cib',
                name: 'Commercial International Bank',
                nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ø¯ÙˆÙ„ÙŠ',
                interestRate: 17.75,
                maxLoanAmount: 20000000,
                maxTerm: 25,
                minDownPayment: 15,
                processingFee: 1.25,
                features: ['Ø£Ø³Ø¹Ø§Ø± ÙØ§Ø¦Ø¯Ø© ØªÙ†Ø§ÙØ³ÙŠØ©', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©', 'ØªÙ…ÙˆÙŠÙ„ ÙŠØµÙ„ Ø¥Ù„Ù‰ 85%']
            },
            {
                id: 'qnb',
                name: 'QNB Al Ahli Bank',
                nameAr: 'Ø¨Ù†Ùƒ Ù‚Ø·Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠ',
                interestRate: 18.25,
                maxLoanAmount: 12000000,
                maxTerm: 30,
                minDownPayment: 20,
                processingFee: 1.0,
                features: ['Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø©', 'Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø§Ù„Ø³Ø¯Ø§Ø¯', 'Ø®Ø¯Ù…Ø§Øª Ø±Ù‚Ù…ÙŠØ© Ù…ØªØ·ÙˆØ±Ø©']
            },
            {
                id: 'aaib',
                name: 'Arab African International Bank',
                nameAr: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠ',
                interestRate: 19.0,
                maxLoanAmount: 10000000,
                maxTerm: 25,
                minDownPayment: 25,
                processingFee: 1.75,
                features: ['Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ', 'Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø¬Ø§Ù†ÙŠØ©', 'ØªÙ‚ÙŠÙŠÙ… Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¹Ù‚Ø§Ø±']
            },
            {
                id: 'banque_misr',
                name: 'Banque Misr',
                nameAr: 'Ø¨Ù†Ùƒ Ù…ØµØ±',
                interestRate: 18.75,
                maxLoanAmount: 8000000,
                maxTerm: 30,
                minDownPayment: 20,
                processingFee: 1.5,
                features: ['Ø¨Ù†Ùƒ Ø­ÙƒÙˆÙ…ÙŠ Ù…ÙˆØ«ÙˆÙ‚', 'Ø´Ø±ÙˆØ· Ù…Ø±Ù†Ø©', 'ÙØ±ÙˆØ¹ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª']
            }
        ];

        // Utility functions
        const formatEGP = (amount) => {
            return new Intl.NumberFormat('ar-EG', {
                style: 'currency',
                currency: 'EGP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
                notation: amount >= 1000000 ? 'compact' : 'standard',
            }).format(amount);
        };

        const formatArabicTime = () => {
            return new Date().toLocaleString('ar-EG', {
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric',
                hour12: true
            });
        };

        const log = (message, type = 'info') => {
            const console = document.getElementById('console');
            const time = formatArabicTime();
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${time}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        };

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide tab content
            document.getElementById('calculator-tab').style.display = tabName === 'calculator' ? 'block' : 'none';
            document.getElementById('affordability-tab').style.display = tabName === 'affordability' ? 'block' : 'none';
            
            log(`ğŸ”„ Switched to ${tabName} tab`);
        }

        // Initialize banks display
        function initializeBanks() {
            const banksGrid = document.getElementById('banksGrid');
            banksGrid.innerHTML = egyptianBanks.map(bank => `
                <div class="bank-card" onclick="selectBank('${bank.id}')">
                    <div class="bank-name">${bank.name}</div>
                    <div class="bank-name-ar">${bank.nameAr}</div>
                    <div class="bank-rate">Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ${bank.interestRate}%</div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">
                        Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${formatEGP(bank.maxLoanAmount)} | Ù…Ø¯Ø©: ${bank.maxTerm} Ø³Ù†Ø©
                    </div>
                    <div class="bank-features">
                        ${bank.features.slice(0, 2).map(feature => `â€¢ ${feature}`).join('<br>')}
                    </div>
                </div>
            `).join('');
        }

        // Select bank
        function selectBank(bankId) {
            selectedBank = egyptianBanks.find(bank => bank.id === bankId);
            
            // Update UI
            document.querySelectorAll('.bank-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('selectedBankName').textContent = selectedBank.nameAr;
            
            log(`ğŸ›ï¸ Selected bank: ${selectedBank.nameAr} (${selectedBank.interestRate}% interest rate)`, 'success');
        }

        // Calculate mortgage
        function calculateMortgage() {
            const propertyPrice = parseFloat(document.getElementById('propertyPrice').value);
            const downPaymentPercent = parseFloat(document.getElementById('downPaymentPercent').value);
            const termYears = parseInt(document.getElementById('termYears').value);

            if (!propertyPrice || !selectedBank || !downPaymentPercent || !termYears) {
                log('âŒ Missing required data. Please fill all fields and select a bank.', 'error');
                return;
            }

            const downPayment = (propertyPrice * downPaymentPercent) / 100;
            const loanAmount = propertyPrice - downPayment;

            // Validate bank limits
            if (loanAmount > selectedBank.maxLoanAmount) {
                log(`âŒ Loan amount exceeds bank limit. Max: ${formatEGP(selectedBank.maxLoanAmount)}`, 'error');
                return;
            }

            if (downPaymentPercent < selectedBank.minDownPayment) {
                log(`âŒ Down payment below bank minimum. Required: ${selectedBank.minDownPayment}%`, 'error');
                return;
            }

            // Calculate monthly payment
            const monthlyRate = selectedBank.interestRate / 100 / 12;
            const numPayments = termYears * 12;
            const monthlyPayment = loanAmount * 
                (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
                (Math.pow(1 + monthlyRate, numPayments) - 1);

            const totalAmount = monthlyPayment * numPayments;
            const totalInterest = totalAmount - loanAmount;
            const processingFee = loanAmount * (selectedBank.processingFee / 100);
            const finalMonthlyPayment = monthlyPayment + (processingFee / numPayments);

            currentCalculation = {
                propertyPrice,
                downPayment,
                loanAmount,
                monthlyPayment: finalMonthlyPayment,
                totalInterest,
                totalAmount: totalAmount + processingFee,
                bankName: selectedBank.nameAr,
                interestRate: selectedBank.interestRate,
                termYears,
                processingFee
            };

            displayResults();
            generatePaymentSchedule(loanAmount, monthlyPayment, monthlyRate, numPayments);

            log(`âœ… Mortgage calculated successfully!`, 'success');
            log(`   Monthly payment: ${formatEGP(finalMonthlyPayment)}`, 'success');
            log(`   Total interest: ${formatEGP(totalInterest)}`, 'success');
        }

        // Display calculation results
        function displayResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${formatEGP(currentCalculation.monthlyPayment)}</div>
                    <div class="result-label">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                </div>
                <div class="result-card">
                    <div class="result-value">${formatEGP(currentCalculation.downPayment)}</div>
                    <div class="result-label">Ø§Ù„Ù…Ù‚Ø¯Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
                </div>
                <div class="result-card">
                    <div class="result-value">${formatEGP(currentCalculation.loanAmount)}</div>
                    <div class="result-label">Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø±Ø¶</div>
                </div>
                <div class="result-card">
                    <div class="result-value">${formatEGP(currentCalculation.totalInterest)}</div>
                    <div class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯</div>
                </div>
            `;
            document.getElementById('resultsSection').style.display = 'block';
        }

        // Generate payment schedule
        function generatePaymentSchedule(loanAmount, monthlyPayment, monthlyRate, numPayments) {
            const scheduleRows = document.getElementById('scheduleRows');
            let balance = loanAmount;
            let rows = '';

            for (let month = 1; month <= Math.min(numPayments, 60); month++) { // First 5 years
                const interestPayment = balance * monthlyRate;
                const principalPayment = monthlyPayment - interestPayment;
                balance -= principalPayment;

                rows += `
                    <div class="schedule-row">
                        <div>${month}</div>
                        <div>${formatEGP(monthlyPayment)}</div>
                        <div>${formatEGP(principalPayment)}</div>
                        <div>${formatEGP(interestPayment)}</div>
                        <div>${formatEGP(Math.max(0, balance))}</div>
                    </div>
                `;
            }

            scheduleRows.innerHTML = rows;
        }

        // Show payment schedule
        function showPaymentSchedule() {
            const schedule = document.getElementById('paymentSchedule');
            if (schedule.style.display === 'none') {
                schedule.style.display = 'block';
                log('ğŸ“Š Payment schedule displayed (first 5 years)', 'info');
            } else {
                schedule.style.display = 'none';
                log('ğŸ“Š Payment schedule hidden', 'info');
            }
        }

        // Calculate affordability
        function calculateAffordability() {
            const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value);
            
            if (!monthlyIncome) {
                log('âŒ Please enter monthly income for affordability calculation', 'error');
                return;
            }

            const maxMonthlyPayment = monthlyIncome * 0.33; // 33% debt-to-income ratio
            const estimatedRate = 18.5; // Average rate
            const estimatedTerm = 25; // years

            // Calculate maximum loan amount
            const monthlyRate = estimatedRate / 100 / 12;
            const numPayments = estimatedTerm * 12;
            const maxLoanAmount = maxMonthlyPayment *
                (Math.pow(1 + monthlyRate, numPayments) - 1) /
                (monthlyRate * Math.pow(1 + monthlyRate, numPayments));

            const estimatedDownPayment = maxLoanAmount * 0.2; // 20%
            const maxPropertyPrice = maxLoanAmount + estimatedDownPayment;

            log('ğŸ¯ Affordability Calculation Complete:', 'success');
            log(`   Monthly income: ${formatEGP(monthlyIncome)}`, 'success');
            log(`   Max property price: ${formatEGP(maxPropertyPrice)}`, 'success');
            log(`   Max loan amount: ${formatEGP(maxLoanAmount)}`, 'success');
            log(`   Recommended monthly payment: ${formatEGP(maxMonthlyPayment)}`, 'success');
            log('   Note: This is an approximate estimate', 'info');
        }

        // Share calculation
        function shareCalculation() {
            if (!currentCalculation) return;

            const shareText = `Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ğŸ 

Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±: ${formatEGP(currentCalculation.propertyPrice)}
Ø§Ù„Ù…Ù‚Ø¯Ù…: ${formatEGP(currentCalculation.downPayment)}
Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø±Ø¶: ${formatEGP(currentCalculation.loanAmount)}
Ø§Ù„Ø¨Ù†Ùƒ: ${currentCalculation.bankName}
Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ${currentCalculation.interestRate}%
Ù…Ø¯Ø© Ø§Ù„Ù‚Ø±Ø¶: ${currentCalculation.termYears} Ø³Ù†Ø©

Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ: ${formatEGP(currentCalculation.monthlyPayment)}
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯: ${formatEGP(currentCalculation.totalInterest)}
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº: ${formatEGP(currentCalculation.totalAmount)}

ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµØ±ÙŠØ© ğŸ‡ªğŸ‡¬`;

            navigator.clipboard.writeText(shareText).then(() => {
                log('ğŸ“¤ Calculation copied to clipboard for sharing', 'success');
            }).catch(() => {
                log('ğŸ“¤ Share calculation (copy failed, but would work in mobile app)', 'info');
            });
        }

        // Save calculation
        function saveCalculation() {
            if (!currentCalculation) return;
            
            // Simulate saving to AsyncStorage (would work in mobile app)
            const savedCalculations = JSON.parse(localStorage.getItem('saved_calculations') || '[]');
            savedCalculations.push({
                ...currentCalculation,
                id: Date.now().toString(),
                calculatedAt: new Date()
            });
            localStorage.setItem('saved_calculations', JSON.stringify(savedCalculations));
            
            log(`ğŸ’¾ Calculation saved successfully (${savedCalculations.length} total saved)`, 'success');
        }

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            initializeBanks();
            log('ğŸš€ Egyptian Mortgage Calculator Test Interface Loaded');
            log('ğŸ¦ Ready to test mortgage calculations with Egyptian banks');
            log('');
            log('Features available:');
            log('âœ… 5 major Egyptian banks with real interest rates');
            log('âœ… Comprehensive mortgage calculations');
            log('âœ… Payment schedule visualization');
            log('âœ… Affordability calculator');
            log('âœ… Bank limits and requirements validation');
            log('âœ… Save and share functionality');
            log('âœ… EGP currency formatting');
            log('âœ… Arabic localization');
            log('');
            log('Select a bank and enter property details to start! ğŸ¯');
        });
    </script>
</body>
</html> 